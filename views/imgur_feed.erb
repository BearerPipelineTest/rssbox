<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>imgur:<%= @user_id %></id>
  <title><%= @username %> on Imgur</title>
  <icon>https://s.imgur.com/images/favicon-96x96.png</icon>
  <link href="<%= request.original_url %>" rel="self" />
  <link href="https://imgur.com/user/<%= @username %>" rel="alternate" />
  <updated><%= Time.at(@data[0]["datetime"].to_i) if @data[0] %></updated>
<%- @data.each do |image| -%>

  <entry>
    <id>imgur:image:<%= image["id"] %><%= ":#{params[:cachebuster]}" if params[:cachebuster] %></id>
    <title><%= image["title"].to_line.esc %> [<%= "#{image["width"]}x#{image["height"]}" %>]</title>
    <link href="https://imgur.com/<%= image["id"] %>" />
    <updated><%= Time.at(image["datetime"].to_i) %></updated>
    <author><name><%= @username %></name></author>
    <content type="html">
<%=
ext = image["type"].split("/")[1]
<<-EOF.esc
<a href="https://i.imgur.com/#{image["id"]}.#{ext}"><img src="https://i.imgur.com/#{image["id"]}h.#{ext}"></a>

<p>#{image["description"]}</p>
<p><a href="https://imgur.com/download/#{image["id"]}/#{URI.encode(image["title"])}">Download</a></p>
<p>Size: #{image["size"].to_filesize} (#{image["width"]}x#{image["height"]})</p>
EOF
-%>
    </content>
  </entry>
<%- end -%>
</feed>
